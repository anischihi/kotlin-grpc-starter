/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Kotlin application project to get you started.
 * For more details take a look at the 'Building Java & JVM projects' chapter in the Gradle
 * User Manual available at https://docs.gradle.org/6.8.3/userguide/building_java_projects.html
 */
buildscript {
  ext.kotlinVersion = '1.3.72'
  ext.coroutinesVersion = '1.3.7'
  ext.protobufPlugInVersion = '0.8.12'
  ext.protobufVersion = '3.12.2'
  ext.grpcVersion = '1.29.0'
  ext.grpcKotlinVersion = '0.1.3'

  repositories {
    mavenCentral()
  }

  dependencies {
    classpath "com.google.protobuf:protobuf-gradle-plugin:${protobufPlugInVersion}"
    classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlinVersion"
  }
}
plugins {
  // Apply the org.jetbrains.kotlin.jvm Plugin to add support for Kotlin.
  id 'org.jetbrains.kotlin.jvm' version '1.4.20'

  // Apply the application plugin to add support for building a CLI application in Java.
  id 'application'

  id 'com.google.protobuf' version "${protobufPlugInVersion}"
  id 'idea'

}

repositories {
  // Use JCenter for resolving dependencies.
  jcenter()
}

dependencies {
  // Align versions of all Kotlin components
  implementation platform('org.jetbrains.kotlin:kotlin-bom')

  // Use the Kotlin JDK 8 standard library.
  implementation 'org.jetbrains.kotlin:kotlin-stdlib-jdk8'

  // This dependency is used by the application.
  implementation 'com.google.guava:guava:29.0-jre'

  // Use the Kotlin test library.
  testImplementation 'org.jetbrains.kotlin:kotlin-test'

  // Use the Kotlin JUnit integration.
  testImplementation 'org.jetbrains.kotlin:kotlin-test-junit'

  implementation "org.jetbrains.kotlinx:kotlinx-coroutines-core:$coroutinesVersion"

  // grpc and protobuf
  implementation "com.google.protobuf:protobuf-java:$protobufVersion"
  implementation "com.google.protobuf:protobuf-java-util:$protobufVersion"
  implementation "io.grpc:grpc-netty-shaded:$grpcVersion"
  implementation "io.grpc:grpc-protobuf:$grpcVersion"
  implementation "io.grpc:grpc-stub:$grpcVersion"
  implementation "io.grpc:grpc-kotlin-stub:$grpcKotlinVersion"
  // https://mvnrepository.com/artifact/javax.annotation/javax.annotation-api
  implementation group: 'javax.annotation', name: 'javax.annotation-api', version: '1.3.2'

}

application {
  // Define the main class for the application.
  mainClass = 'grpc.playground.AppKt'
}

idea {
  module {
    sourceDirs += file("${projectDir}/src/generated/main/java")
    sourceDirs += file("${projectDir}/src/generated/main/grpc")
    sourceDirs += file("${projectDir}/src/generated/main/grpckt")
  }
}


protobuf {
  protoc {
    artifact = "com.google.protobuf:protoc:$protobufVersion"
  }

  plugins {
    grpc {
      artifact = "io.grpc:protoc-gen-grpc-java:$grpcVersion"
    }

    grpckt {
      artifact = "io.grpc:protoc-gen-grpc-kotlin:$grpcKotlinVersion"
    }
  }

  generateProtoTasks {
    all().each { task ->
      task.plugins {
        // Generate Java gRPC classes
        grpc { }
        // Generate Kotlin gRPC using the custom plugin from library
        grpckt { }
      }
    }
  }
}